#!/usr/bin/env python3
# Use jadx to unpack APK to a directory
# Enter lib/x86_64/
# Invoke unpacker
# Get a bunch of DLL files
from elftools.elf.elffile import ELFFile
from zipfile import ZipFile
from io import BytesIO
import gzip, string

data = open('libmonodroid_bundle_app.so', "rb").read()
f = BytesIO(data)
elffile = ELFFile(f)
section = elffile.get_section_by_name('.dynsym')

for symbol in section.iter_symbols():
  if symbol['st_shndx'] != 'SHN_UNDEF' and symbol.name.startswith('assembly_data_'):
    print(symbol.name)
    dll_data = data[symbol['st_value']:symbol['st_value']+symbol['st_size']]
    dll_data = gzip.GzipFile(fileobj=BytesIO(dll_data)).read()
    outfile = open(symbol.name[14:].replace('_dll', '.dll'), 'wb')
    outfile.write(dll_data)
    outfile.close()
