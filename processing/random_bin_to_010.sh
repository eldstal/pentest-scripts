#!/bin/bash
#
# Convert a binary file (just raw bytes) to
# the 010 text format expected by the NIST SP800-22 test suite
# e.g. https://github.com/stevenang/randomness_testsuite

INFILE=${1:-/dev/stdin}


# Based on the command name, interpret input
# as hex or as binary
MYSELF=$(basename "${0}")

IN_FORMAT="bin"
if [[ $MYSELF == *hex* ]]; then
  IN_FORMAT="hex"
fi

function hexfilter {

  if [ "${IN_FORMAT}"  == "hex" ]; then
    tr -d '\n' | xxd -plain -revert -
  else
    cat -
  fi

}

cat ${INFILE} | hexfilter \
  | xxd -bits -groupsize 1 -cols 1 - \
  | cut -d ' ' -f 2 \
  | tr -d '\n'
