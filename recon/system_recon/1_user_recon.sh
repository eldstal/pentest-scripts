#!/bin/bash
# Run as user

DO_FS=0

function die {
  echo $*
  exit 1
}

DEST="${1}"

SCRIPT="${BASH_SOURCE}"
RECON_ROOT=$(cd `dirname "${SCRIPT}"` && pwd)
source "${RECON_ROOT}/_setup.env"

LINPEAS=${RECON_ROOT}/utils/linpeas.sh
LES=${RECON_ROOT}/utils/les.sh
LYNISDIR=${RECON_ROOT}/utils/lynis
ROOTDIRS=$(ls / | egrep -v '^proc|^sys')

[ -z "$DEST" ] && die "$0 <dest-dir>"

[ -e "$DEST" -a ! -d "$DEST" ] && die "${DEST} already exists."


mkdir -p $DEST || die "Unable to create ${DEST}"
cd $DEST || die "Unable to enter ${DEST}"


echo "User-level checks..."

uname -a > sysinfo.txt
lsb_release >> sysinfo.txt

echo "Kernel modules..."
lsmod > modules.txt



if [ -x "${LINPEAS}" ]; then
  echo "LinPEAS..."
  ${LINPEAS} > linpeas.txt
fi

if [ -x "${LES}" ]; then
  echo "Linux Exploit Suggester..."
  ${LES} > linux-exploit-suggester.txt
fi

distro_specific_user "${DEST}"

echo "Done."

