#!/bin/env -S jq -r -f
#
# jq -r -f sarif_summarize.jq *.sarif | jq -s "unique"
#
# Summarizes SAST findings and removes duplicates
#
# I can't figure out how to slurp in a pipeline,
# so for now you'll have to pipe this:

def array(s): [s];

.["runs"][]["results"][]
| { id: .ruleId,
    msg: .message.text,
    file: .locations[0].physicalLocation.artifactLocation.uri,
    line: .locations[0].physicalLocation.region.startLine }
