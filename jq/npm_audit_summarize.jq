#!/bin/env -S jq -r -f
#
# npm audit --json --production | jq -r -f npm_audit_summarize.jq
# Prints findings as severity, package name, advisory URL


##
## npm 6.14.4
def npm_6:
  [ .advisories[] ]
  | sort_by(.cvss.score) | reverse
  | .[] | { severity: .severity, url: .url, module_name: .module_name }

  # Optionally, latex-ify it
  # Comment this line out to get JSON output
  | "\\item (" + .severity + ") " + .module_name + " \\url{" + .url + "}"
;

##
## npm 7.7.6
def npm_7:
  [ .vulnerabilities[].via[] | objects ]
  | sort_by(.severity)
  | .[] | { severity: .severity, url: .url, range: .range, module_name: .name }

  # Optionally, latex-ify it
  # Comment this line out to get JSON output
  | "\\item (" + .severity + ") " + .module_name + " (" + .range + ") \\url{" + .url + "}"

;

npm_7
