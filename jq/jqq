#!/bin/bash

FILENAME=${1}
TEMPFILE=""

if [ -z "${FILENAME}" ]; then
  TEMPFILE=$(mktemp)
  cat - > ${TEMPFILE}
  FILENAME="${TEMPFILE}"
fi

echo "" | fzf -q "." \
          --print-query \
          --phony \
          --no-mouse \
          --preview-window=up,99% \
          --bind up:preview-up,down:preview-down \
          --bind pgup:preview-page-up,pgdn:preview-page-down \
          --preview "cat ${FILENAME} | jq --color-output {q}" \
          | head -n 1 \
          | sed -e "s/\\(.*\\)/jq '\\1'/"


if [ -n "${TEMPFILE}" ]; then
  rm "${TEMPFILE}"
fi
